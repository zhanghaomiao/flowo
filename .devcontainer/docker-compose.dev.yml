services:
  flowo-backend:
    # 1. 覆盖 Dockerfile 里的 USER nonroot，必须用 root 启动
    # 这样 VS Code 才能安装 Node.js 和其他工具
    user: root
    
    # 2. 挂载整个项目根目录到 /workspace，并添加 :z (解决 Podman SELinux)
    volumes:
      - ..:/workspace:z
    
    # 3. 覆盖 Dockerfile 的工作目录，统一在 /workspace 下工作
    working_dir: /workspace
    
    # 4. 让容器无限休眠，等待我们在 VS Code 终端手动启动 fastapi
    entrypoint: ["sleep", "infinity"]
    
    # 5. Podman 必须配置：保持用户 ID 映射，防止文件归属权混乱
    userns_mode: keep-id

  # 开发模式下，直接禁用原本的前端容器（因为它是 Nginx，没法开发）
  flowo-frontend:
    entrypoint: ["echo", "Frontend disabled in dev mode"]
    restart: "no"